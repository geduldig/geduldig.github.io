<!DOCTYPE html>
<meta charset="utf-8">

<body>
	<div>
		<video height=200 autoplay style="border:1px solid blue;"></video>
	</div>
	<div>
		<button onclick="snapshot()">Take Picture</button>
	</div>
	<div>
		<canvas height="200" style="border:1px solid red;"></canvas><br>
	</div>

<script>
	var video = document.querySelector('video');
	var localMediaStream = null;

	navigator.getUserMedia = navigator.getUserMedia || 
	                         navigator.webkitGetUserMedia || 
	                         navigator.mozGetUserMedia || 
	                         navigator.msGetUserMedia;

	navigator.getUserMedia({video:true}, onMediaStream, onMediaFail);

	function onMediaStream(stream) {
		window.URL = window.URL || window.webkitURL;
		video.src = window.URL.createObjectURL(stream);
		localMediaStream = stream;
		video.onloadedmetadata = function(e) {
			var width = this.videoWidth;
			var height = this.videoHeight;
			//alert(width + ' - ' + height);
			//video.style.width = this.videoWidth/2;
			//video.style.height = this.videoHeight/2;
		};
	}

	function onMediaFail(e) {
		console.log('Camera did not work.', e);
	}

	function snapshot() {
		if (localMediaStream) {
			var canvas = document.querySelector('canvas');
			var ctx = canvas.getContext('2d');
			var h = video.height;
			var w = h * video.videoWidth/video.videoHeight;
			canvas.width = w;
			canvas.height = h;
			ctx.drawImage(video, 0, 0, w, h);
		}
	}
</script>
