<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" href="../css/style.css">

<body> 
	<span>
		<video height=200 autoplay style="border:1px solid blue;"></video>
	</span> 
	<span>
		<canvas height="200" style="border:1px solid red;"></canvas><br>
	</span>
	<div>
		<button onclick="snapshot()">Take Picture</button>
	</div>

	<script>
		var video = document.querySelector('video');
		var canvas = document.querySelector('canvas');
		var localMediaStream = null;

		/*
		navigator.getUserMedia = 
			navigator.getUserMedia || 
			navigator.webkitGetUserMedia || 
			navigator.mozGetUserMedia || 
			navigator.msGetUserMedia;
		navigator.getUserMedia({video:true}, onMediaStream, onMediaFail);
		*/
		navigator.mediaDevices.getUserMedia({video:true}).then(function(stream) {
			onMediaStream(stream);
		}).catch(function(err) {
			onMediaFail(err);
		});

		function onMediaStream(stream) {
			window.URL = window.URL || window.webkitURL;
			//video.src = window.URL.createObjectURL(stream);
			video.srcObject = stream;
			console.log('==video.src:', video.srcObject)
			localMediaStream = stream;
			video.onloadedmetadata = function(e) {
				console.log('==onloadedmetadata...')
				var h = video.height;
				var w = h * video.videoWidth/video.videoHeight;
				canvas.width = w;
				canvas.height = h;
			};
		}

		function onMediaFail(e) {
			console.log('Camera did not work.', e.message);
		}

		function snapshot() {
			if (localMediaStream) {
				var ctx = canvas.getContext('2d');
				ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
			}
		}
	</script>
